Author: Joseph Lee
E-Mail: fdlixiaojun@gmail.com

### 关于CPU的操作模式和对计算机资源的保护
操作系统为应用程序提供对计算机硬件的一致视图，通过CPU提供的不同操作模式，操作
系统可以实现程序的独立操作和保护资源不受非法访问。CPU在不同操作模式下只可以执
行相应范围的指令集，这样可以实现对硬件等资源的保护。

### 当前进程
current宏，包含头文件<linux/sched.h>
当前实现是将task_struct结构的指针隐藏在内核栈中，这种结构不依赖于特定架构的具体
实现，快速，而且可以方便的支持SMP系统。（不理解）

### 内核栈很小（1~2页），谨慎使用，需要大的自动变量应该动态分配和释放。

### 模块名为modulename.ko，由源文件file1.c和file2.c生成，Makfile写法如下：
	obj-m	:= modulename.o
	modulename-objs	:= file1.o file2.o

### insmod和modprobe工作机理
它依赖于kernel/module.c中的一个系统调用sys_init_module，通过它给模块分配内存
（函数vmalloc负责内存分配）以便加载模块，然后，它将模块正文复制到分配好的内存
区域，并通过内核符号表解析模块中的内核引用，最后调用模块的初始化函数。
tips: 有且只有系统调用的名字前面有sys_前缀。
modprobe与insmod类似，但是它会检查装载的模块是否引用了一些当前内核不存在的符号，
如果有，则会在当前模块搜索路径中查找定义了这些符号的其他模块，找到的话加载。而
这种情况下使用insmod会失败并记录日志。
/proc/modules文件和/sys/module目录

### 内核版本信息以及vermagic.o，该文件包含了许多内核信息，可用来检查模块兼容性
<linux/version.h>头文件
一般而言，依赖于特定版本或平台的代码应该位于低层宏或者函数之后。

块设备：随机无序访问固定大小的块，通常安装文件系统
字符设备：字符流方式有序访问
根本区别：能否随机访问，随意跳转到位置，按块方式还是字符流方式
字符设备

---------------------------------------
参考文件:
Linux Device Driver 3rd edition Chapter 2
Linux Device Driver 3rd edition Chapter 3
